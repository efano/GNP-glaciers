<!DOCTYPE html>
<html lang="en">

<head>
    <title>climate line chart</title>

    <link href="https://fonts.googleapis.com/css?family=Nunito:900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Istok+Web|Open+Sans&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Istok Web', 'Open Sans', sans-serif;
            color: #484848;
            background-color: whitesmoke;
        }
    </style>
</head>

<body>
    <div id="wrapper1"></div>
    <div id="wrapper2"></div>

    <script src="https://d3js.org/d3.v5.min.js"></script>

    <script>

        // ******* Monthly Temperature Chart ***********

        async function drawLineChart1() {
            const dataset = await d3.json("data/climate-G1-monthly.json")
            console.table(dataset[0]);
            const yAccessor = d => d.TMEANF;
            const dateParser = d3.timeParse("%Y-%m");
            const xAccessor = d => dateParser(d.DATE);
            console.log(xAccessor(dataset[0]));

            let dimensions = {
                width: window.innerWidth * 0.3,
                height: 250,
                margin: {
                    top: 15,
                    right: 15,
                    bottom: 40,
                    left: 60,
                },
            }

            dimensions.boundedWidth = dimensions.width -
                dimensions.margin.left -
                dimensions.margin.right
            dimensions.boundedHeight = dimensions.height -
                dimensions.margin.top -
                dimensions.margin.bottom

            // Draw canvas

            const wrapper = d3.select("#wrapper1")
                .append("svg")
                .attr("width", dimensions.width)
                .attr("height", dimensions.height)

            const bounds = wrapper.append("g")
                .style("transform", `translate(${
                  dimensions.margin.left
                }px, ${
                  dimensions.margin.top
                }px)`)

            // Create scales

            const yScale = d3.scaleLinear()
                .domain(d3.extent(dataset, yAccessor))
                .range([dimensions.boundedHeight, 0])

            const xScale = d3.scaleTime()
                .domain(d3.extent(dataset, xAccessor))
                .range([0, dimensions.boundedWidth])

            const lineGenerator = d3.line()
                .x(d => xScale(xAccessor(d)))
                .y(d => yScale(yAccessor(d)))

            const line = bounds.append("path")
                .attr("d", lineGenerator(dataset))
                .attr("fill", "none")
                .attr("stroke", "#c8c8c8")
                .attr("stroke-width", 1)

            const yAxisGenerator = d3.axisLeft()
                .scale(yScale)

            const yAxis = bounds.append("g")
                .call(yAxisGenerator)

            // Add label to Y axis
            yAxis.append("text")
                .attr("fill", "#000")
                .attr("transform", "rotate(-90)")
                .attr("y", -35)
                .attr("x", -95)
                .attr("text-anchor", "middle")
                .html("Mean Monthly Temperature (&#8239;&#8457;&#8239;)");

            const xAxisGenerator = d3.axisBottom()
                .scale(xScale)

            const xAxis = bounds.append("g")
                .call(xAxisGenerator)
                .style("transform", `translateY(${
                  dimensions.boundedHeight
                }px)`)

            // Add label to X axis
            xAxis.append("text")
                .attr("fill", "#000")
                .attr("x", 165)
                .attr("y", 35)
                .attr("text-anchor", "middle")
                .text("Year");


        };
        drawLineChart1()

        // ******* Annual Temperature Chart ***********

        async function drawLineChart2() {
            const dataset = await d3.csv("data/climate-G1-annual.csv")
            console.table(dataset[0]);
            const yAccessor = d => d.TMEANF;
            const dateParser = d3.timeParse("%Y");
            const xAccessor = d => dateParser(d.YEAR);
            console.log(xAccessor(dataset[0]));

            let dimensions = {
                width: window.innerWidth * 0.3,
                height: 200,
                margin: {
                    top: 15,
                    right: 15,
                    bottom: 40,
                    left: 60,
                },
            }

            dimensions.boundedWidth = dimensions.width -
                dimensions.margin.left -
                dimensions.margin.right
            dimensions.boundedHeight = dimensions.height -
                dimensions.margin.top -
                dimensions.margin.bottom

            // Draw canvas

            const wrapper = d3.select("#wrapper2")
                .append("svg")
                .attr("width", dimensions.width)
                .attr("height", dimensions.height)

            const bounds = wrapper.append("g")
                .style("transform", `translate(${
                    dimensions.margin.left
                }px, ${
                    dimensions.margin.top
                }px)`)

            // Create scales

            const yScale = d3.scaleLinear()
                .domain(d3.extent(dataset, yAccessor))
                .range([dimensions.boundedHeight, 0])

            const xScale = d3.scaleTime()
                .domain(d3.extent(dataset, xAccessor))
                .range([0, dimensions.boundedWidth])

            const lineGenerator = d3.line()
                .x(d => xScale(xAccessor(d)))
                .y(d => yScale(yAccessor(d)))
                .curve(d3.curveBasis);

            const line = bounds.append("path")
                .attr("d", lineGenerator(dataset))
                .attr("fill", "none")
                .attr("stroke", "#c8c8c8")
                .attr("stroke-width", 2)

            const yAxisGenerator = d3.axisLeft()
                .scale(yScale)
                .ticks(5)

            const yAxis = bounds.append("g")
                .call(yAxisGenerator)

            // Add label to Y axis
            yAxis.append("text")
                .attr("fill", "#000")
                .attr("transform", "rotate(-90)")
                .attr("y", -35)
                .attr("x", -70)
                .attr("text-anchor", "middle")
                .html("Mean Annual Temperature (&#8239;&#8457;&#8239;)");

            const xAxisGenerator = d3.axisBottom()
                .scale(xScale)

            const xAxis = bounds.append("g")
                .call(xAxisGenerator)
                .style("transform", `translateY(${
                    dimensions.boundedHeight
                }px)`)

            // Add label to X axis
            xAxis.append("text")
                .attr("fill", "#000")
                .attr("x", 165)
                .attr("y", 35)
                .attr("text-anchor", "middle")
                .text("Year");


        };
        drawLineChart2()

    </script>


</body>

</html>