<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, width=device-width">
    <link rel="icon" type="image/svg+xml" href="icons/mountain-fav.svg">

    <title>Our Vanishing Glaciers</title>

    <link href="https://api.mapbox.com/mapbox-assembly/v0.24.0/assembly.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.6.0/leaflet.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400&family=Nunito:wght@900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/BeerSlider.css">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            cursor: default !important;
            font-family: 'Lato', sans-serif;
        }

        html {
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
        }

        #map {
            position: absolute;
            width: 100%;
            top: 50px;
            bottom: 0;
            background-color: whitesmoke;
            z-index: -1;
        }

        #loader {
            position: absolute;
            top: 50%;
            left: 0%;
            margin: -33px 0 0 -33px;
            width: 100%;
            z-index: 1010;
        }

        .navbarParent {
            background: white;
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.2);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            margin: auto;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            height: 50px;
            align-content: center;
        }

        .fullTitle {
            padding-top: 8px;
            padding-left: 16px;
        }

        #mountain-icon {
            width: 32px;
            height: 32px;
        }

        .fullTitleText {
            margin-top: -28px;
            margin-left: 40px;
            align-content: center;
        }

        .navbar-title {
            font-size: 26px;
            font-weight: bold;
            color: #333;
        }

        .vl {
            color: #989898;
            font-size: 24px;
            font-weight: lighter;
            margin-right: 6px;
            margin-left: 6px;
        }

        .navbar-subtitle {
            font-size: 18px;
            font-weight: normal;
            font-style: italic;
            color: #989898;
        }

        #icon-group {
            float: right;
            align-content: center;
            white-space: nowrap;
            padding-right: 12px;
            padding-top: 12px;
        }

        .navbar-icon {
            font-size: 26px;
            color: #00acc1;

        }

        .navbar-icon:hover {
            color: #0097A7;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 1275px) {
            .vl {
                display: none;
            }

            .navbar-subtitle {
                display: none;
            }
        }

        @media (max-width: 615px) {
            .navbar-title {
                display: inline-block;
                word-spacing: 9999999px;
                font-size: 7px;
                line-height: 1.3;
                padding-right: 10px;
                margin-top: -3px;
            }

            .vl {
                display: none;
            }

            .navbar-subtitle {
                display: none;
            }

            .leaflet-control-attribution {
                display: none;
            }
        }

        @media (max-width: 350px) {
            .navbar-title {
                display: none;
            }

            .vl {
                display: none;
            }

            .navbar-subtitle {
                display: none;
            }

            .leaflet-control-attribution {
                display: none;
            }
        }

        .leaflet-bar {
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }

        #layers-icon:active {
            pointer-events: none;
        }

        #baselayer-btn-dropdown {
            padding: 0px;
        }

        .dropdown-content1 {
            display: none;
            position: absolute;
            background-color: transparent;
            padding-top: 6px;
            z-index: 1001;
        }

        .leaflet-control-layers {
            box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            background: white;
            min-width: 8rem;
            padding: 8px 8px 8px 14px;
        }

        #baselayerDropdown {
            margin-top: -3px;
            color: #333;
            line-height: 1.5;
            font-size: 12px;
            font-weight: 500;
            opacity: 1;
        }

        #baselayerDropdown ::selection {
            font-weight: 600;
            color: #333;
        }

        .leaflet-control-layers-list {
            color: #333;
        }

        .show1 {
            display: block;
        }

        #baselayerDropdown .leaflet-control-layers-selector {
            position: absolute;
            left: -100vw;
        }

        #radioText:hover {
            font-weight: 600;
            color: #0097a7;
        }

        .leaflet-control-layers-selector:checked~#radioText {
            font-weight: 600;
            color: #0097a7;
            text-decoration: underline;
        }

        #globe-icon {
            margin-right: 2px;
            margin-top: -2px;
            margin-left: -2px;
        }

        .globe {
            width: 30px;
            height: 30px;
        }

        #glacier-btn-dropdown {
            display: inline-block;
            background-color: #00acc1;
            color: #fff;
            border-radius: 18px;
            text-align: center;
            transition: background-color 0.125s,
                border-color 0.125s,
                color 0.125s;
        }

        #glacier-btn-dropdown:hover {
            background-color: #0097a7;
            transition: background-color 0.125s,
                border-color 0.125s,
                color 0.125s;
        }

        .btn--s {
            font-size: 14px;
            font-weight: 600;
            line-height: 18px;
            padding: 5px 12px;
        }

        .glacierDropdown {
            margin-top: -2px;
            position: relative;
            display: inline-block;
        }

        .dropdown-content2 {
            display: none;
            position: absolute;
            background-color: white;
            opacity: 1;
            right: 0px;
            margin-top: 6px;
            padding-top: 8px;
            padding-bottom: 8px;
            width: 154px;
            box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            border-radius: 5px;
            max-height: 95vh;
            overflow: auto;
        }

        #dropdown-list2 {
            text-decoration: none;
            display: block;
            color: #333;
            line-height: 1.5;
            font-size: 12px;
            font-weight: 500;
            padding: 0px 10px 10px 16px;
        }

        #dropdown-list2 :hover {
            font-weight: 600;
            color: #0097a7;
        }

        #dropdown-list2 ::selection {
            font-weight: 600;
            color: #333;
        }

        .show2 {
            display: block;
        }

        .highlight {
            font-weight: 600;
            color: #0097a7;
        }

        .leaflet-control-scale-line {
            border: 1px solid #333;
            border-top: none;
            line-height: .7;
            padding: 2px 5px 1px;
            font-size: 9px;
            white-space: nowrap;
            overflow: hidden;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            background: rgba(255, 255, 255, .5);
        }

        .leaflet-control-scale-line:not(:first-child) {
            border-top: 1px solid #333;
            border-bottom: none;
            margin-top: 1px;
        }

        .leaflet-control-scale-line:not(:first-child):not(:last-child) {
            border-bottom: 1px solid #333;
        }

        .leaflet-tooltip {
            border-radius: 5px;
            box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.2);
        }

        .tooltipTitle {
            white-space: nowrap;
            color: #333;
            font-size: 13px;
            font-weight: 600;
        }

        .tooltipText {
            font-size: 1em;
            font-weight: 500;
            color: #333;
            margin-top: -19px;
        }

        .tooltipPct {
            font-weight: 600;
        }

        .tooltipTextArea {
            font-weight: 500;
            margin-left: 9px;
        }

        .tooltipTextAcres {
            font-weight: 500;
            margin-left: 40px;
        }

        .polyTooltipText {
            font-size: .93em;
            font-weight: 500;
            color: #333;
            margin-top: -18px;
        }

        .polyTooltipTextArea {
            font-size: .93em;
            font-weight: 500;
            margin-left: 9px;
        }

        .polyTooltipTextAcres {
            font-size: .93em;
            font-weight: 500;
            margin-left: 40px;
        }

        .polyAreaBold,
        .barArea {
            font-weight: 600;
            color: #ff3d00;
        }

        .barTooltipTextAcres {
            font-weight: 500;
            margin-left: 30px;
        }

        .glacierPtLegend {
            background-color: rgba(255, 255, 255, 1);
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            left: 11px;
            bottom: 11px;
            width: 196px;
            position: absolute;
            z-index: 950;
            color: #333;
            max-height: calc(100vh - 0px - 140px);
            overflow-y: auto;
        }

        .glacierPtLegend h4 {
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.1px;
            margin-top: 12px;
            margin-left: 16px;
        }

        .glacierPtLegend h6 {
            font-size: 12px;
            font-weight: 600;
            margin-left: 16px;
            margin-top: -4px;
        }

        #gradient {
            display: inline-block;
            height: 12px;
            width: 160px;
            margin-left: 16px;
            border-radius: 7px;
            background-image: linear-gradient(to right, #FFD6BC, #ffccbc, #ffab91, #ff7043, #f4511e, #e64a19, #bf360c, #A62E0A)
        }

        #gradientGreatest {
            font-size: 0.6em;
            font-weight: 600;
            color: #989898;
            margin-left: 18px;
            margin-top: -10px;
            margin-bottom: -8px;
        }

        #sizeCrit {
            margin-left: 20px;
            margin-top: 2px;
            list-style: none;
            line-height: .95;
            color: #333;
        }

        .glacierPtLegendText {
            font-size: 12px;
            font-weight: 500;
            color: #333;
        }

        #secondLegendGroup {
            padding-bottom: 16px;
        }

        #ui-pt-control {
            margin-top: 4px;
            margin-left: 5px;
        }

        #ui-lineCharts-control {
            margin-top: 3px;
            margin-left: 8px;
        }

        .toggle {
            color: #00acc1;
        }

        #ui-pt-control .toggle {
            font-size: 12px;
            font-weight: 600;
            line-height: 15px;
            padding: 1px 15px;
            margin-right: -6px;
        }

        #ui-lineCharts-control .toggle {
            font-size: 12px;
            font-weight: 600;
            line-height: 15px;
            padding: 3px 17px;
            margin-right: -6px;
        }

        #ui-pt-control input:checked+.toggle,
        #ui-lineCharts-control input:checked+.toggle {
            background: #00acc1;
            color: #fff;
        }

        .toggle-group :hover,
        .toggle-group :active {
            color: #0097a7;
        }

        #symbolActive {
            color: #444444;
            font-size: 19px;
            margin-left: 3px;
        }

        #symbolStangnant {
            font-family: 'Nunito', sans-serif;
            font-weight: 900;
            font-size: 16px;
            margin-left: 5px;
            color: #444444;
        }

        #stangnant {
            margin-left: 2px;
        }

        .glacierPtLegendText {
            line-height: 1.1em;
        }

        #glacierPtLegendSm,
        #glacierPolyLegendSm {
            background-color: rgba(255, 255, 255, 1);
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            left: 11px;
            bottom: 11px;
            width: 36px;
            height: 34px;
            position: absolute;
            z-index: 950;
        }

        .legend-icon {
            height: 26px;
            width: 26px;
            margin-left: 5px;
            margin-top: 5px;
            opacity: 0.8;
        }

        .legend-icon:hover {
            opacity: 1.0;
        }

        .closePtIcon {
            float: right;
            height: 18px;
            width: 18px;
            padding: 2px;
            opacity: 0.4;
        }

        .closePtIcon:hover {
            opacity: 1.0;
        }

        /* modal css */
        .popup_content {
            font-family: "Gotu", sans-serif;
            margin: 10px;
            padding: 10px 20px;
            max-width: 60%;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 5px;
        }

        .modalTitle {
            font-size: 18px;
            font-weight: 600;
            margin-top: 12px;
            margin-bottom: 10px;
        }

        .attributionLM1 {
            font-size: 8px;
            text-align: left;
            float: left;
            margin-top: -10px;
        }

        .attributionRM1 {
            font-size: 8px;
            text-align: right;
            float: right;
            margin-top: -10px;
        }

        .attributionLM2 {
            font-size: 8px;
            text-align: left;
            float: left;
        }

        .attributionRM2 {
            font-size: 8px;
            text-align: right;
            float: right;
        }

        .attributionRM3 {
            font-size: 8px;
            text-align: right;
            float: right;
        }

        .side-left[year-left]:after {
            content: attr(year-left);
            position: absolute;
            top: 12px;
            left: 12px;
            line-height: 1;
            padding: 0.5rem;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.75);
        }

        .side-right[year-right]:after {
            content: attr(year-right);
            position: absolute;
            top: 12px;
            right: 12px;
            line-height: 1;
            padding: 0.5rem;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.75);
        }

        .modal-body {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .modal-body-container {
            position: relative;
            text-align: center;
            color: #333;
        }

        #closeIcon1,
        #closeIcon2,
        #closeIcon3 {
            font-size: 24px;
            font-weight: 600;
            color: #989898;
        }

        #closeIcon1 :hover,
        #closeIcon2 :hover,
        #closeIcon3 :hover {
            font-weight: 600;
            color: #333;
        }

        .image {
            border-radius: 5px;
        }

        #modal3 {
            width: 35%;
            height: auto;
        }

        /* glacier polygon legend css */
        .legendPolyList {
            position: absolute;
            bottom: 0px;
            background-color: rgba(255, 255, 255, 1);
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            text-align: left;
            width: 305px;
            max-height: calc(100vh - 0px - 130px);
            overflow-y: auto;
        }

        .closePolyIcon {
            float: right;
            height: 18px;
            width: 18px;
            padding: 2px;
            opacity: 0.4;
        }

        .closePolyIcon:hover {
            opacity: 1.0;
        }

        .polyLegendMain {
            margin: 16px 16px;
        }

        .polyLegendTitle {
            font-size: 22px;
            font-weight: bold;
            letter-spacing: 0.15px;
            color: #333;
        }

        #camera-icon {
            float: right;
            opacity: 0.8;
            margin-top: 5px;
            margin-bottom: 16px;
        }

        #camera-icon:hover {
            opacity: 1.0;
        }

        .polyLegendAreaTitle {
            font-size: 15px;
            color: #333;
            font-weight: bold;
            letter-spacing: 0.1px;
            margin-top: 16px;
        }

        #switchGroup1 {
            margin-top: -2px;
            margin-bottom: -8px;
            margin-left: 8px;
        }

        #switchGroup2 {
            margin-left: 8px;
        }

        #switchGroup2 li {
            list-style: none;
            margin: 0;
            padding: 0;
            display: inline-flex
        }

        .switchInner {
            height: 17px;
            width: 17px;
            border-width: 1.5px;
            border-radius: 5px;
            border-color: #00acc1;
        }

        .checkbox>.icon {
            position: absolute;
            width: 17px;
            height: 17px;
            top: -2px;
            left: -2px;
            right: 0px;
            background-color: #00acc1;
            border-radius: 5px;
        }

        .switchText {
            font-size: 12px;
            font-weight: 500;
            color: #333333;
            margin-top: 4px;
            margin-left: 4px;
            margin-right: 16px;
        }

        .areaChartTitle {
            font-size: 15px;
            color: #333;
            letter-spacing: 0.1px;
            font-weight: 600;
            margin-top: 19px;
        }

        .areaChartText {
            font-size: 12px;
            font-weight: 500;
            color: #333333;
            margin-top: 6px;
            margin-left: 8px;
        }

        .areaChartCalcs {
            color: #ff3d00;
            font-weight: 600;
        }

        /* poly legend bar chart css */
        #wrapper1 {
            position: relative;
            z-index: 1000;
            color: #989898;
            margin-top: 5px;
            margin-left: 8px;
        }

        .bar {
            fill: #00acc1;
            opacity: 0.9;
            /* stroke: #00838F; */
            /* stroke-width: 1px;
            stroke-opacity: 1; */
        }

        .barHover,
        .bar:hover {
            stroke: #ff3d00;
            stroke-width: 1.75px;
            stroke-opacity: 1;
        }

        .tooltip1 {
            height: auto;
            transition: all 0.1s ease-out;
            pointer-events: none;
            padding: 8px;
            background: #fff;
            border: 1px solid #f0f0f0;
            text-align: left;
            line-height: 1.4em;
            color: #333;
            font-size: 11px;
            font-weight: 500;
            border-radius: 5px;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.15);
            z-index: 1000;
        }

        .tooltip1:before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 8px;
            height: 8px;
            background: white;
            border: 1px solid #ddd;
            border-top-color: transparent;
            border-left-color: transparent;
            transform: translate(-50%, 50%) rotate(45deg);
            transform-origin: center center;
            z-index: 1000;
        }

        .x-axis,
        .y-axis {
            font-size: 9px;
        }

        /* poly legend climate chart css */
        .climateDataTitle {
            font-size: 15px;
            color: #333;
            letter-spacing: 0.1px;
            font-weight: 600;
            margin-top: 10px;
        }

        #legendLine1,
        #legendLine3 {
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
            margin-top: -18px;
        }

        #legendLine2,
        #legendLine4 {
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
            margin-top: -36px;
        }

        #legendLineText1,
        #legendLineText4 {
            color: #333;
            font-size: 12px;
            font-weight: 500;
            margin-left: 2px;
            display: inline-block;
        }

        #legendLineText2,
        #legendLineText5 {
            color: #333;
            font-size: 12px;
            font-weight: 500;
            margin-left: 2px;
            display: inline-block;
        }

        #legendLineText3,
        #legendLineText6 {
            color: #333;
            font-size: 12px;
            font-weight: 500;
            margin-left: 16px;
            margin-top: -6px;
        }

        #wrapper2,
        #wrapper3 {
            position: relative;
            z-index: 1000;
            color: #989898;
            margin-top: -8px;
            margin-left: -10px;
        }

        .listening-rect {
            fill: transparent;
        }

        .line {
            fill: none;
            stroke: #333;
            stroke-width: 2;
        }

        .tooltip2,
        .tooltip3 {
            opacity: 0;
            position: absolute;
            bottom: 120px;
            left: 15px;
            padding: 0.6em;
            background: #fff;
            border: 1px solid #f0f0f0;
            text-align: left;
            line-height: 1.4em;
            font-size: 11px;
            font-weight: 500;
            z-index: 1010;
            transition: all 0.1s ease-out;
            pointer-events: none;
            border-radius: 5px;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.15);
        }

        .tooltip2:before,
        .tooltip3:before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 8px;
            height: 8px;
            background: white;
            border: 1px solid #ddd;
            border-top-color: transparent;
            border-left-color: transparent;
            transform: translate(-50%, 50%) rotate(45deg);
            transform-origin: center center;
            z-index: 1010;
        }

        .barYear,
        .tooltip-date {
            margin-bottom: 0.1em;
            color: #333;
            font-size: 1.2em;
            font-weight: 600;
            padding-top: 4px;
        }

        #temp {
            color: #ff3d00;
            font-weight: 600;
        }

        #precip {
            color: #00BCD4;
            font-weight: 600;
        }

        .year {
            fill: #fff;
        }

        .year.group1,
        .year.group3 {
            fill: #f2f2f2;
        }

        .year-group-mean1 {
            fill: none;
            stroke: #ff3d00;
            stroke-width: 1.5;
        }

        .year-group-mean2 {
            fill: none;
            stroke: #00BCD4;
            stroke-width: 1.5;
        }
    </style>
</head>

<body>
    <div class="navbarParent">
        <div class="navbar">
            <div class="fullTitle">
                <div class="logo">
                    <img id="mountain-icon" src="icons/mountain.svg">
                </div>
                <div class="fullTitleText">
                    <span class="navbar-title">Our Vanishing Glaciers</span>
                    <span class="vl">|</span>
                    <span class="navbar-subtitle">Visualizing a Half-Century of Glacier Loss in Glacier National Park,
                        Montana</span>
                </div>
            </div>

            <nav class="main-nav">
                <div class="flex-parent-inline" id="icon-group">

                    <a class="navbar-icon" href="https://github.com/efano/GNP-glaciers/blob/master/README.md"
                        target="_blank" id="info-icon" title="Project Information">
                        <svg class="icon mr6 info">
                            <use xlink:href="#icon-info" />
                        </svg>
                    </a>

                    <div class="baselayerDropdown">
                        <button class="btn btn--white" id="baselayer-btn-dropdown" onclick="baselayerDropdownFunction()"
                            title="Select Basemap">
                            <div class="navbar-icon" id="layers-icon">
                                <svg class="icon mr6 grid">
                                    <use xlink:href="#icon-grid" />
                                </svg>
                            </div>
                        </button>
                        <div id="baselayerDropdownList" class="dropdown-content1">
                            <div id="baselayerDropdown"></div>
                        </div>
                    </div>

                    <div class="navbar-icon" href="#" id="globe-icon" title="Zoom to Park Extent">
                        <svg class="icon mr6 globe">
                            <use xlink:href="#icon-globe" />
                        </svg>
                    </div>

                    <div class="glacierDropdown">
                        <button onclick="glacierDropdownFunction()" class="btn btn--s" id="glacier-btn-dropdown">Select
                            Glacier &thinsp;&#9662;</button>
                        <div id="glacierDropdownList" class="dropdown-content2">
                            <ul id="dropdown-list2"></ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <div id="map">
        <div class="flex-child loading" id="loader"></div>
    </div>

    <div hidden id="glacierPtLegendSm" class="glacierPtLegendSm">
        <div class="legendIcon" title="Maximize Legend">
            <img class="legend-icon" src="icons/legend.svg">
        </div>
    </div>

    <!-- point legend elements -->
    <div id="glacierPtLegend" class="glacierPtLegend">
        <div class="legendPtCloseIcon" title="Minimize Legend">
            <img class="closePtIcon" src="icons/close.svg">
        </div>
        <div>
            <h4>Glacier Area Loss</h4>
            <h6>(1966 &ndash; 2015)</h6>
            <div id="areaGradient">
                <div id="gradient"></div>
                <div id="gradientGreatest"> &emsp; &emsp; &#8594; &emsp; &emsp; &#8594; &emsp; &emsp; &#8594; &emsp;
                    &emsp;
                    Greatest</div>
            </div>
        </div>
        <div id="secondLegendGroup">
            <h4>Minimum Size Criterion</h4>
            <h6>(0.1 km&sup2; or &asymp;&thinsp;25 acres)</h6>
            <ul id="sizeCrit">
                <li>
                    <div class="toggle-group" id="ui-pt-control">
                        <label class="toggle-container">
                            <input checked name="toggle-small pt-radio" type="radio" id="1966" value="active1966" />
                            <div class="toggle">1966</div>
                        </label>
                        <label class="toggle-container">
                            <input name="toggle-small pt-radio" type="radio" id="2015" value="active2015" />
                            <div class="toggle">2015</div>
                        </label>
                    </div>
                </li>
                <li>
                    <span class="glacierPtLegendText" id="symbolActive">&#x25C6;</span>
                    <span class="glacierPtLegendText" id="active">Active (&thinsp;&#8805;&thinsp;&#8239;0.1
                        km&sup2;&#8239;)</span>
                </li>
                <li>
                    <span class="glacierPtLegendText" id="symbolStangnant">x</span>
                    <span class="glacierPtLegendText" id="stangnant">Stagnant (&#8239;&lt; 0.1
                        km&sup2;&#8239;)</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- polygon legend elements -->
    <div hidden id="glacierPolyLegendSm" class="glacierPolyLegendSm">
        <div class="legendPolyIcon" title="Maximize Legend">
            <img class="legend-icon" src="icons/legend.svg">
        </div>
    </div>
    <div hidden class="legendPolyCloseIcon">
        <div class="closePolyIconDiv" title="Minimize Legend">
            <img class="closePolyIcon" src="icons/close.svg">
        </div>
    </div>
    <div>
        <a hidden href="#" id="photoIcon">
            <img id="camera-icon" src="icons/camera.svg" title="View Photograph">
        </a>
    </div>

    <!-- modals -->
    <div hidden class="modalsAll" id="page">

        <!-- modal1 -->
        <div class="modal photoModals" id="modal1">
            <div class="modalHeader">
                <div class="modalTitle" id="photo-slider-label"></div>
                <button class="absolute top right px12 py12 modal_close">
                    <svg class="icon link color-darken50 modal1_close" id="closeIcon1">
                        <use xlink:href="#icon-close"></use>
                    </svg>
                </button>
            </div>
            <div id="beer-slider1" class="beer-slider yearRM1" data-beer-label=" ">
                <img src="photos/placeholder.jpg" class="image" id="imageRightM1" alt="imageRight">
                <div class="beer-reveal yearLM1" data-beer-label=" ">
                    <img src="photos/placeholder.jpg" class="image" id="imageLeftM1" alt="imageLeft">
                </div>
            </div>
            <div>
                <div class="attributionLM1" value="attributionLeft"></div>
                <div class="attributionRM1" value="attributionRight"></div>
            </div>
        </div>

        <!-- modal2 -->
        <div hidden class="modal photoModals" id="modal2">
            <div class="modalHeader">
                <div class="modalTitle" id="photo-side2side-label"></div>
                <button class="absolute top right px12 py12  modal_close">
                    <svg class="icon link color-darken50 modal2_close" id="closeIcon2">
                        <use xlink:href="#icon-close"></use>
                    </svg>
                </button>
            </div>
            <div class="modal-body modal-body-container">
                <img src="photos/placeholder.jpg" class="image" alt="" id="imageM2">
                <div class="side-left yearLM2" year-left=" "></div>
                <div class="side-right yearRM2" year-right=" "></div>
                <div>
                    <div class="attributionLM2" value="attributionLeft"></div>
                    <div class="attributionRM2" value="attributionRight"></div>
                </div>
            </div>
        </div>

        <!-- modal3 -->
        <div hidden class="modal photoModals" id="modal3">
            <div class="modalHeader">
                <div class="modalTitle" id="photo-single-label"></div>
                <button class="absolute top right px12 py12  modal_close">
                    <svg class="icon link color-darken50 modal3_close" id="closeIcon3">
                        <use xlink:href="#icon-close"></use>
                    </svg>
                </button>
            </div>
            <div class="modal-body modal-body-container">
                <img id="imageM3" src="photos/placeholder.jpg" class="image" alt="">
                <div class="side-right yearRM3" year-right=" "></div>
                <div>
                    <div class="attributionRM3" value="attributionRight"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- polygon years checkboxes -->
    <div hidden id="polygonYearsGroup">
        <ul id="switchGroup1">
            <li>
                <label class="checkbox-container">
                    <input type="checkbox" id="polyLIA" class="switchInput" />
                    <div class="checkbox checkbox--darken50 switchInner">
                        <svg class="icon">
                            <use xlink:href="#icon-check" /></svg>
                    </div>
                    <span class="switchText">Mid-19th century (Little Ice Age)</span>
                </label>
            </li>
        </ul>
        <ul id="switchGroup2">
            <li>
                <label class="checkbox-container">
                    <input checked type="checkbox" id="poly66" class="switchInput" />
                    <div class="checkbox checkbox--darken50 switchInner">
                        <svg class="icon">
                            <use xlink:href="#icon-check" /></svg>
                    </div>
                    <span class="switchText">1966</span>
                </label>
                <label class="checkbox-container">
                    <input type="checkbox" id="poly98" class="switchInput" />
                    <div class="checkbox checkbox--darken50 switchInner">
                        <svg class="icon">
                            <use xlink:href="#icon-check" /></svg>
                    </div>
                    <span class="switchText">1998</span>
                </label>
                <label class="checkbox-container">
                    <input type="checkbox" id="poly05" class="switchInput" />
                    <div class="checkbox checkbox--darken50 switchInner">
                        <svg class="icon">
                            <use xlink:href="#icon-check" /></svg>
                    </div>
                    <span class="switchText">2005</span>
                </label>
                <label class="checkbox-container">
                    <input checked type="checkbox" id="poly15" class="switchInput" />
                    <div class="checkbox checkbox--darken50 switchInner">
                        <svg class="icon">
                            <use xlink:href="#icon-check" /></svg>
                    </div>
                    <span class="switchText">2015</span>
                </label>
            </li>
        </ul>
    </div>

    <!-- climate charts -->
    <div hidden id="climateChartsToggle">
        <div class="toggle-group climateToggleGroup" id="ui-lineCharts-control">
            <label class="toggle-container">
                <input checked name="toggle-small line-radio" type="radio" id="tempToggle" value="temperature" />
                <div class="toggle">Temperature</div>
            </label>
            <label class="toggle-container">
                <input name="toggle-small line-radio" type="radio" id="precipToggle" value="precipitation" />
                <div class="toggle">Precipitation</div>
            </label>
        </div>

        <div hidden class="tempDiv" id="tempDiv">
            <div class="legendLines" id="legendLine1">
                <svg height="10" width="10">
                    <line x1="0" y1="0" x2="50" y2="50" style="stroke:#333;stroke-width:2" />
                </svg>
                <div class="legendLineText" id="legendLineText1">Average annual air temperature</div>
            </div>
            <div class="legendLines" id="legendLine2">
                <svg height="10" width="10">
                    <line x1="0" y1="0" x2="50" y2="50" style="stroke:#ff3d00;stroke-width:1.75" />
                </svg>
                <div class="legendLineText" id="legendLineText2">Average air temperature between</div>
                <div class="legendLineText3" id="legendLineText3">measurements</div>
            </div>
            <div class="wrapper2" id="wrapper2"></div>
        </div>

        <div hidden class="precipDiv" id="precipDiv">
            <div class="legendLines" id="legendLine3">
                <svg height="10" width="10">
                    <line x1="0" y1="0" x2="50" y2="50" style="stroke:#333;stroke-width:2" />
                </svg>
                <div class="legendLineText" id="legendLineText4">Total annual precipitation</div>
            </div>
            <div>
                <div class="legendLines" id="legendLine4">
                    <svg height="10" width="10">
                        <line x1="0" y1="0" x2="50" y2="50" style="stroke:#00BCD4;stroke-width:1.75" />
                    </svg>
                    <div class="legendLineText" id="legendLineText5">Average precipitation between</div>
                    <div class="legendLineText3" id="legendLineText6">measurements</div>
                </div>
                <div class="wrapper3" id="wrapper3"></div>
            </div>
        </div>

    </div>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="js/BeerSlider.js"></script>
    <script src="js/jquery.popupoverlay.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.6/chroma.min.js"></script>
    <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.24.0/assembly.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.6.0/leaflet-src.js"></script>
    <script src="js/leaflet-svg-shape-markers.js"></script>

    <script>
        // navbar dropdowns
        // show baselayer dropdown menu
        function baselayerDropdownFunction() {
            document.getElementById("baselayerDropdownList").classList.toggle("show1");
        }
        window.addEventListener('click', function (event) {
            if (!event.target.matches('#baselayer-btn-dropdown')) {
                const dropdown1 = document.getElementsByClassName("dropdown-content1");
                let i;
                for (i = 0; i < dropdown1.length; i++) {
                    const openDropdown1 = dropdown1[i];
                    if (openDropdown1.classList.contains('show1')) {
                        openDropdown1.classList.remove('show1');
                    }
                }
            }
        });

        // show glaciers dropdown menu
        function glacierDropdownFunction() {
            document.getElementById("glacierDropdownList").classList.toggle("show2");
        }
        window.addEventListener('click', function (event) {
            if (!event.target.matches('#glacier-btn-dropdown')) {
                const dropdown2 = document.getElementsByClassName("dropdown-content2");
                let i;
                for (i = 0; i < dropdown2.length; i++) {
                    const openDropdown2 = dropdown2[i];
                    if (openDropdown2.classList.contains('show2')) {
                        openDropdown2.classList.remove('show2');
                    }
                }
            }
        });

        $(document).ready(function () {

            // set default `pagecontainer` for all popups (optional, but recommended for screen readers and iOS
            $.fn.popup.defaults.pagecontainer = '#page'

            // initialize the modal plugin
            $('.photoModals').popup({
                transition: 'all 0.6s',
                blur: false
            });

            // initialize photo slider
            $.fn.BeerSlider = function (options) {
                options = options || {};
                return this.each(function () {
                    new BeerSlider(this, options);
                });
            };
            $('.beer-slider').BeerSlider();

            // basemaps
            const topoESRI = L.tileLayer(
                'https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri, USGS, NPS, and the GIS User Community',
                    opacity: 0.85
                });
            const imageryESRI = L.tileLayer(
                'https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri, USGS, NPS, and the GIS User Community',
                    opacity: 0.85
                });
            const topoUSGS = L.tileLayer(
                'https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri, USGS, NPS, and the GIS User Community',
                    opacity: 0.85
                });
            const imageryUSGS = L.tileLayer(
                'https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri, USGS, NPS, and the GIS User Community',
                });
            const imageryTopoUSGS = L.tileLayer(
                'https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles &copy; Esri, USGS, NPS, and the GIS User Community',
                });
            const voyagerCARTO = L.tileLayer(
                'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 19
                });
            const darkCARTO = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 19
            });

            const options = {
                center: [48.65, -113.75],
                zoom: 9,
                maxZoom: 16,
                zoomSnap: .1,
                layers: topoESRI
            };

            const map = L.map('map', options);

            let baseLayers = {
                "ESRI Topo": topoESRI,
                "ESRI Imagery": imageryESRI,
                "USGS Topo": topoUSGS,
                "USGS Imagery": imageryUSGS,
                "USGS Imagery Topo": imageryTopoUSGS,
                "CARTO Voyager": voyagerCARTO,
                "CARTO Dark": darkCARTO,
            };

            // basemap legend
            const control = L.control.layers(baseLayers, null, {
                collapsed: false,
            }).addTo(map);

            // move baselayer control icon to navbar
            let htmlObject = control.getContainer();
            // get the desired parent node
            let newParent = document.getElementById('baselayerDropdown');
            // append the node to the new parent, recursively searching out and re-parenting nodes
            function setParent(el, newParent) {
                newParent.appendChild(el);
            };
            setParent(htmlObject, newParent);

            // assign id to basemap legend to hide radio buttons
            $('#baselayerDropdown .leaflet-control-layers .leaflet-control-layers-list .leaflet-control-layers-base label div span')
                .attr('id', 'radioText');

            // create scalebar
            L.control.scale({
                position: 'bottomright',
                metric: true,
                maxWidth: 120,
            }).addTo(map);

            // global variables
            let status = "active1966";

            // use D3 fetch to request data with async requests
            const parkBoundary = d3.json('data/boundary.json');
            const lia = d3.json('data/lia-poly.json');
            const polys66 = d3.json('data/polys66.json');
            const polys98 = d3.json('data/polys98.json');
            const polys05 = d3.json('data/polys05.json');
            const polys15 = d3.json('data/polys15.json');
            const allPoints = d3.json('data/glacier-pts.json');
            const climateCSV = d3.csv('data/climate-all.csv');
            const areaCSV = d3.csv('data/area-all.csv');


            // use Promise to wait until data is all loaded
            Promise.all([parkBoundary, lia, polys66, polys98, polys05, polys15, allPoints, climateCSV, areaCSV])
                .then(
                    drawMap);

            function drawMap(data) {

                // pull out separate data arrays and assign to variables
                const boundsData = data[0];
                const liaData = data[1];
                const polys66Data = data[2];
                const polys98Data = data[3];
                const polys05Data = data[4];
                const polys15Data = data[5];
                const ptData = data[6];
                const climateData = data[7];
                const areaData = data[8];

                // create a park boundary layer with the geojson data
                const parkBounds = L.geoJson(boundsData, {
                    style: function (feature, layer) {
                        return {
                            color: '#989898',
                            weight: 1.5,
                            lineJoin: 'round',
                            dashArray: '2,4'
                        };
                    }
                }).addTo(map);
                extentIcon(parkBounds);

                // extent button on click
                function extentIcon(parkBounds) {
                    $('#globe-icon').click(function () {
                        map.flyToBounds(parkBounds.getBounds());
                    });
                };

                // create a point layer with the geojson data
                const glacierPoints = L.geoJson(ptData, {
                    pointToLayer: function (feature, latlng) {
                        return L.shapeMarker(latlng)
                    }
                }).addTo(map);

                // fit map bounds to feature extent
                map.fitBounds(glacierPoints.getBounds(), {
                    padding: [20, 20]
                });

                map.on('zoomend', function () {
                    const zoomlevel = map.getZoom();
                    if (zoomlevel >= 12) {
                        $('#dropdown-list2 .dropdown-item2').removeClass('highlight');
                        $(".glacierPtLegend").fadeOut();
                        $(".glacierPtLegendSm").fadeOut();
                        if (map.hasLayer(glacierPoints)) {
                            map.removeLayer(glacierPoints);
                        }
                        $(".leaflet-tooltip-pane").empty();
                        map.addLayer(allPolys);
                        addInteractionsLIA(liaLayer);
                        addInteractions66(layer66);
                        addInteractions98(layer98);
                        addInteractions05(layer05);
                        addInteractions15(layer15);
                        togglePolys();
                    }
                    if (zoomlevel < 12 && zoomlevel > 8) {
                        liaLayer.resetStyle();
                        layer66.resetStyle();
                        layer98.resetStyle();
                        layer05.resetStyle();
                        layer15.resetStyle();
                        if (map.hasLayer(allPolys)) {
                            map.removeLayer(allPolys);
                        }
                        $("#glacier-btn-dropdown").html("Select Glacier &thinsp;&#9662;").text();
                        map.addLayer(glacierPoints);
                        drawPts(glacierPoints);
                        drawPtLegend();
                        $(".legendPolyList").fadeOut("fast");
                        $('#glacierPolyLegendSm').fadeOut("fast");
                        $(".leaflet-tooltip-pane").empty();
                        $('#dropdown-list2 .dropdown-item2').removeClass('highlight');
                    }
                    if (zoomlevel <= 8) {
                        $('#dropdown-list2 .dropdown-item2').removeClass('highlight');
                        $(".glacierPtLegend").fadeOut();
                        $(".glacierPtLegendSm").fadeOut();
                        if (map.hasLayer(glacierPoints)) {
                            map.removeLayer(glacierPoints);
                        }
                    }
                });

                // call functions
                drawPts(glacierPoints);
                buildPtUI(glacierPoints);
                drawDropDownList(ptData);
                highlightGlacier(glacierPoints);
                zoomToGlacier(glacierPoints);
                removeLists();
                drawPolyLegend();
                drawPtLegend();
                togglePtLegend();

                // draw glacier points
                function drawPts(glacierPoints) {
                    colorize = getColors(glacierPoints);
                    glacierPoints.eachLayer(function (layer) {
                        let props = layer.feature.properties;
                        let type = props[status];

                        if (type === "y") {
                            layer.bringToBack();
                            layer.setStyle({
                                shape: "diamond",
                                color: '#333',
                                fillColor: colorize(props.pctD),
                                fillOpacity: 1,
                                weight: 1.2,
                                radius: 7,
                            })
                        } else if (type === "n") {
                            layer.bringToFront();
                            layer.setStyle({
                                shape: "x",
                                color: colorize(props.pctD),
                                weight: 3,
                                radius: 7,
                            })
                        };

                        // tooltip
                        layer.bindTooltip("<div class=tooltipTitle><b>" + props["GLACNAME"] +
                            "</b></div><br>" +
                            "<div class=tooltipText>" + "Area loss:&thinsp;" +
                            '<a class="tooltipPct" style="color:' + colorize(props.pctD) + '"> ' + (
                                parseFloat(
                                    props["pctD"]) *
                                100).toFixed(0) + "%" + '</a>', {
                                opacity: 1
                            }
                        );

                        //when mousing over a glacier point
                        layer.on('mouseover', function () {
                            layer.bringToFront();
                            // provide a visual affordance
                            layer.setStyle({
                                radius: 16
                            });
                            // select the cooresponding list item and add the highlight class to make bold
                            $('#glacierList-' + props.num).addClass('highlight');
                        });

                        layer.on('mouseout', function () {
                            // reset back to our base styling opacity
                            layer.setStyle({
                                radius: 7
                            });
                            $('#glacierList-' + props.num).removeClass('highlight');
                        });

                        layer.on('mousedown', function () {
                            let num = layer.feature.properties.num
                            map.removeLayer(glacierPoints);
                            $("#wrapper2").empty();
                            $("#wrapper3").empty();
                            // change 'Select Glacier' button to glacier name
                            btnObj = $("#glacier-btn-dropdown");
                            $(btnObj).text($(".highlight").text());
                            $(btnObj).val($(".highlight").text());
                            $('[id="glacierDropdownList"]').removeClass('show2');
                            $('[id="baselayerDropdownList"]').removeClass('show1');

                            // loop through the glacier lia polygons
                            liaLayer.eachLayer(function (layer) {
                                let glacierNum = parseInt(num);
                                let liaProps = layer.feature.properties.num;
                                // if the glacier id matches...
                                if (liaProps === glacierNum) {
                                    updatePolyLegend(layer);
                                    map.flyToBounds(layer.getBounds(), {
                                        padding: [10, 10]
                                    });
                                }
                            });

                            if ($(".glacierPtLegendSm").is(":visible")) {
                                $(".glacierPtLegendSm").fadeOut("fast");
                            } else {
                                $(".glacierPtLegend").fadeOut("fast");
                            }

                            $(".legendPolyList").fadeIn(1600);
                        });
                    })
                };

                // draw pt legend
                function drawPtLegend() {
                    if ($(".glacierPtLegendSm").is(":visible")) {
                        $(".glacierPtLegendSm").fadeIn(1000);
                    } else {
                        $(".glacierPtLegend").fadeIn(1500);
                    }
                };

                // toggle pt legend
                function togglePtLegend() {
                    $('.legendPtCloseIcon').click(function () {
                        $('.glacierPtLegend').fadeOut();
                        $('.glacierPtLegendSm').fadeIn();
                    });

                    $('.glacierPtLegendSm').click(function () {
                        $('.glacierPtLegendSm').fadeOut();
                        $('.glacierPtLegend').fadeIn();
                    });
                };

                // build active/static toggle ui
                function buildPtUI(glacierPoints) {
                    $("input[name='toggle-small pt-radio']").change(function () {
                        let activeTxt = this.value;
                        status = activeTxt;
                        drawPts(glacierPoints);
                    });
                };

                // create color scheme for point layer
                function getColors(glacierPoints) {
                    // create chroma.js color scheme
                    const glacierLoss = [];

                    // loop through the glacier points
                    glacierPoints.eachLayer(function (layer) {
                        glacierLoss.push(layer.feature.properties.pctD);
                    });

                    // use chroma.limits to determine
                    const breaks = chroma.limits(glacierLoss, 'q', 7);
                    // build a colorize function
                    let colorize = chroma
                        .scale(['#ffccbc', '#ffab91', '#ff7043', '#f4511e', '#e64a19', '#bf360c'])
                        .domain(breaks)
                        .mode('lch');
                    return colorize;
                };

                // create Select Glacier dropdown list
                function drawDropDownList(ptData) {
                    // store a reference to the glacier dropdown list
                    const legendList = $('#dropdown-list2');
                    const legendNameList = [];
                    for (names in ptData.features) {
                        const props = ptData.features[names].properties;
                        legendNameList.push(props);
                    };

                    // alphabetize glacier dropdown list
                    legendNameList.sort(function (a, b) {
                        return a.GLACNAME - b.GLACNAME
                    });
                    // add glacier names to the glacier dropdown list
                    for (let i = 1; i <= ptData.features.length; i++) {
                        const legendNames = [legendNameList[i - 1].GLACNAME];
                        legendList.append('<li><a class="dropdown-item2" id="glacierList-' + i + '" value=' +
                            i + '>' +
                            legendNames + '</a></li>');
                    };
                };

                // hightlight pt layer from dropdown list
                function highlightGlacier(glacierPoints) {

                    // select list items and on mouseover
                    $('.dropdown-item2').on('mouseover', function () {
                        // extract the specific number from the specific item being moused over
                        let num = this.id.replace('glacierList-', '');
                        glacierNum = parseInt(num);

                        // loop through the glacier points
                        glacierPoints.eachLayer(function (layer) {
                            // if the glacier id matches...
                            if (layer.feature.properties.num === glacierNum) {
                                // change the layer style
                                layer.setStyle({
                                    radius: 16
                                }).bringToFront();
                            };

                            // deselects layer highlight on legend mouseout
                            $('.dropdown-item2').on('mouseout', function () {
                                layer.setStyle({
                                    radius: 7
                                });
                            });
                        });
                    })
                };

                map.createPane("liaLayer");
                map.getPane("liaLayer").style.zIndex = 446;
                map.createPane("layer66");
                map.getPane("layer66").style.zIndex = 447;
                map.createPane("layer98");
                map.getPane("layer98").style.zIndex = 448;
                map.createPane("layer05");
                map.getPane("layer05").style.zIndex = 449;
                map.createPane("layer15");
                map.getPane("layer15").style.zIndex = 450;

                // create a LIA layer with the geojson data
                const liaLayer = L.geoJson(liaData, {
                    style: function (feature, layer) {
                        return {
                            color: "#a9a7ab",
                            fillColor: "white",
                            weight: 1.5,
                            opacity: 1,
                            fillOpacity: 0.4,
                            lineJoin: 'round',
                            dashArray: '3,4',
                            pane: "liaLayer",
                        };
                    },
                });

                const layer66 = L.geoJson(polys66Data, {
                    style: function (feature, layer) {
                        return {
                            color: "#26C6DA",
                            fillColor: "#80DEEA",
                            weight: 1.5,
                            opacity: 1,
                            fillOpacity: 0.4,
                            lineJoin: 'round',
                            dashArray: '3,4',
                            pane: "layer66",
                        };
                    },
                });

                const layer98 = L.geoJson(polys98Data, {
                    style: function (feature, layer) {
                        return {
                            color: "#00BCD4",
                            fillColor: "#4DD0E1",
                            weight: 1.5,
                            opacity: 1,
                            fillOpacity: 0.4,
                            lineJoin: 'round',
                            dashArray: '3,4',
                            pane: "layer98",
                        };
                    }
                });

                const layer05 = L.geoJson(polys05Data, {
                    style: function (feature, layer) {
                        return {
                            color: "#00ACC1",
                            fillColor: "#26C6DA",
                            weight: 1.5,
                            opacity: 1,
                            fillOpacity: 0.4,
                            lineJoin: 'round',
                            dashArray: '3,4',
                            pane: "layer05",
                        };
                    }
                });

                const layer15 = L.geoJson(polys15Data, {
                    style: function (feature, layer) {
                        return {
                            color: "#00A0B5",
                            fillColor: "#00BCD4",
                            weight: 1.5,
                            opacity: 1,
                            fillOpacity: 0.4,
                            lineJoin: 'round',
                            dashArray: '3,4',
                            pane: "layer15",
                        };
                    }
                });

                const allPolys = L.layerGroup([liaLayer, layer66, layer98, layer05, layer15]);

                // add lia poly interactions
                function addInteractionsLIA(liaLayer) {
                    liaLayer.eachLayer(function (layer) {
                        let polyProps = layer.feature.properties;

                        layer.on('mouseover', function () {
                            layer.setStyle({
                                color: "#ff3d00",
                                weight: 2,
                            });
                            // select the corresponding list item and add the highlight class to make bold
                            $('#glacierList-' + polyProps.num).addClass('highlight');
                        });

                        layer.on('mouseout', function () {
                            layer.setStyle({
                                color: "#a9a7ab",
                                weight: 1.5,
                            });
                            $('#glacierList-' + polyProps.num).removeClass('highlight');
                        });

                        // tooltip
                        layer.bindTooltip("<div class=tooltipTitle><b>" + polyProps["GLACNAME"] +
                            "</b></div><br>" +
                            "<div class=polyTooltipText>" + "Extent: &thinsp;Mid-19th century" +
                            "<br></div>" +
                            "<div class=polyTooltipTextArea>" + "Area: &thinsp;" +
                            "<span class=polyAreaBold>" + Number(polyProps[
                                "AREA"] * 0.000001).toLocaleString() + " km&sup2; " + "</span>" +
                            "&thinsp;or" + "</div>" +
                            "<div class=polyTooltipTextAcres>" +
                            "<span class=polyAreaBold>" + (polyProps["AREA"] *
                                0.0002471053814671738146717).toFixed(3) + " acres" +
                            "</span></div>", {
                                opacity: 1,
                                sticky: true,
                            }
                        );
                    });
                };

                // add poly66 interactions
                function addInteractions66(layer66) {
                    layer66.eachLayer(function (layer) {
                        let polyProps = layer.feature.properties;

                        layer.on('mouseover', function () {
                            layer.setStyle({
                                color: "#ff3d00",
                                weight: 2,
                            });

                            // select the corresponding list item and add the highlight class to make bold
                            $('#glacierList-' + polyProps.num).addClass('highlight');

                            // highlight bar chart bar
                            let legendPolyName = $('#glacier-btn-dropdown').val();
                            if (polyProps.GLACNAME === legendPolyName) {
                                $('#bar3').addClass('barHover');
                            };
                        });

                        layer.on('mouseout', function () {
                            layer.setStyle({
                                color: "#26C6DA",
                                weight: 1.5,
                            });

                            $('#glacierList-' + polyProps.num).removeClass('highlight');
                            $('#bar3').removeClass('barHover');
                        });

                        // tooltip
                        layer.bindTooltip("<div class=tooltipTitle><b>" + polyProps[
                                "GLACNAME"] +
                            "</b></div><br>" +
                            "<div class=polyTooltipText>" + "Extent: &thinsp;1966" +
                            "<br></div>" +
                            "<div class=polyTooltipTextArea>" + "Area: &thinsp;" +
                            "<span class=polyAreaBold>" + Number(polyProps[
                                "AREA"] * 0.000001).toLocaleString() + " km&sup2; " + "</span>" +
                            "&thinsp;or" + "</div>" +
                            "<div class=polyTooltipTextAcres>" +
                            "<span class=polyAreaBold>" + (polyProps["AREA"] *
                                0.0002471053814671738146717).toFixed(3) + " acres" +
                            "</span></div>", {
                                opacity: 1,
                                sticky: true,
                            }
                        );
                    });
                };

                // add poly98 interactions
                function addInteractions98(layer98) {
                    layer98.eachLayer(function (layer) {
                        let polyProps = layer.feature.properties;

                        layer.on('mouseover', function () {
                            layer.setStyle({
                                color: "#ff3d00",
                                weight: 2,
                            });
                            // select the corresponding list item and add the highlight class to make bold
                            $('#glacierList-' + polyProps.num).addClass(
                                'highlight');

                            // highlight bar chart bar
                            let legendPolyName = $('#glacier-btn-dropdown').val();
                            if (polyProps.GLACNAME === legendPolyName) {
                                $('#bar2').addClass('barHover');
                            };
                        });

                        layer.on('mouseout', function () {
                            layer.setStyle({
                                color: "#00BCD4",
                                weight: 1.5,
                            });
                            $('#glacierList-' + polyProps.num).removeClass(
                                'highlight');
                            $('#bar2').removeClass('barHover');
                        });

                        // tooltip
                        layer.bindTooltip("<div class=tooltipTitle><b>" + polyProps[
                                "GLACNAME"] +
                            "</b></div><br>" +
                            "<div class=polyTooltipText>" + "Extent: &thinsp;1998" +
                            "<br></div>" +
                            "<div class=polyTooltipTextArea>" + "Area: &thinsp;" +
                            "<span class=polyAreaBold>" + Number(polyProps[
                                "AREA"] * 0.000001).toLocaleString() + " km&sup2; " + "</span>" +
                            "&thinsp;or" + "</div>" +
                            "<div class=polyTooltipTextAcres>" +
                            "<span class=polyAreaBold>" + (polyProps["AREA"] *
                                0.0002471053814671738146717).toFixed(3) + " acres" +
                            "</span></div>", {
                                opacity: 1,
                                sticky: true,
                            }
                        );
                    });
                };

                // add poly05 interactions
                function addInteractions05(layer05) {
                    layer05.eachLayer(function (layer) {
                        let polyProps = layer.feature.properties;

                        layer.on('mouseover', function () {
                            layer.setStyle({
                                color: "#ff3d00",
                                weight: 2,
                            });
                            // select the corresponding list item and add the highlight class to make bold
                            $('#glacierList-' + polyProps.num).addClass(
                                'highlight');

                            // highlight bar chart bar
                            let legendPolyName = $('#glacier-btn-dropdown').val();
                            if (polyProps.GLACNAME === legendPolyName) {
                                $('#bar1').addClass('barHover');
                            };
                        });

                        layer.on('mouseout', function () {
                            layer.setStyle({
                                color: "#00ACC1",
                                weight: 1.5,
                            });
                            $('#glacierList-' + polyProps.num).removeClass(
                                'highlight');
                            $('#bar1').removeClass('barHover');
                        });

                        // tooltip
                        layer.bindTooltip("<div class=tooltipTitle><b>" + polyProps[
                                "GLACNAME"] +
                            "</b></div><br>" +
                            "<div class=polyTooltipText>" + "Extent: &thinsp;2005" +
                            "<br></div>" +
                            "<div class=polyTooltipTextArea>" + "Area: &thinsp;" +
                            "<span class=polyAreaBold>" + Number(polyProps[
                                "AREA"] * 0.000001).toLocaleString() + " km&sup2; " + "</span>" +
                            "&thinsp;or" + "</div>" +
                            "<div class=polyTooltipTextAcres>" +
                            "<span class=polyAreaBold>" + (polyProps["AREA"] *
                                0.0002471053814671738146717).toFixed(3) + " acres" +
                            "</span></div>", {
                                opacity: 1,
                                sticky: true,
                            }
                        );
                    });
                };

                // add poly15 interactions
                function addInteractions15(layer15) {
                    layer15.eachLayer(function (layer) {
                        let polyProps = layer.feature.properties;

                        layer.on('mouseover', function () {
                            layer.setStyle({
                                color: "#ff3d00",
                                weight: 2,
                            });
                            // select the corresponding list item and add the highlight class to make bold
                            $('#glacierList-' + polyProps.num).addClass(
                                'highlight');

                            // highlight bar chart bar
                            let legendPolyName = $('#glacier-btn-dropdown').val();
                            if (polyProps.GLACNAME === legendPolyName) {
                                $('#bar0').addClass('barHover');
                            };
                        });

                        layer.on('mouseout', function () {
                            layer.setStyle({
                                color: "#00A0B5",
                                weight: 1.5,
                            });
                            $('#glacierList-' + polyProps.num).removeClass(
                                'highlight');
                            $('#bar0').removeClass('barHover');
                        });

                        // tooltip
                        layer.bindTooltip("<div class=tooltipTitle><b>" + polyProps[
                                "GLACNAME"] +
                            "</b></div><br>" +
                            "<div class=polyTooltipText>" + "Extent: &thinsp;2015" +
                            "<br></div>" +
                            "<div class=polyTooltipTextArea>" + "Area: &thinsp;" +
                            "<span class=polyAreaBold>" + Number(polyProps[
                                "AREA"] * 0.000001).toLocaleString() + " km&sup2; " + "</span>" +
                            "&thinsp;or" + "</div>" +
                            "<div class=polyTooltipTextAcres>" +
                            "<span class=polyAreaBold>" + (polyProps["AREA"] *
                                0.0002471053814671738146717).toFixed(3) + " acres" +
                            "</span></div>", {
                                opacity: 1,
                                sticky: true,
                            }
                        );
                    });
                };

                // zoom to glacier from dropdown list and change selected glacier name in button
                function zoomToGlacier(glacierPoints) {

                    // select list items and on mouseover
                    $('.dropdown-item2').on('click', function () {
                        map.removeLayer(glacierPoints);
                        map.removeLayer(allPolys);
                        $("#wrapper2").empty();
                        $("#wrapper3").empty();

                        // extract the specific number from the specific item being moused over
                        let num = this.id.replace('glacierList-', '');
                        glacierNum = parseInt(num);
                        $('#glacierPolyLegendSm').fadeOut("fast");

                        // change 'Select Glacier' button to glacier name
                        btnObj = $(this).parent().parent().parent().siblings('button');
                        $(btnObj).text($(this).text());
                        $(btnObj).val($(this).text());

                        // loop through the glacier lia polygons
                        liaLayer.eachLayer(function (layer) {
                            let polyProps = layer.feature.properties.num;
                            // if the glacier id matches...
                            if (polyProps === glacierNum) {
                                updatePolyLegend(layer);

                                map.flyToBounds(layer.getBounds(), {
                                    padding: [10, 10]
                                });
                            }
                        });

                        if ($(".glacierPtLegendSm").is(":visible")) {
                            $(".glacierPtLegendSm").fadeOut("fast");
                        } else {
                            $(".glacierPtLegend").fadeOut("fast");
                        }

                        $(".legendPolyList").fadeIn(1600);
                    })
                };

                // hide dropdown lists on zoom-click
                function removeLists() {
                    $('.leaflet-control-zoom-in, .leaflet-control-zoom-out').click(function () {
                        $('[id="glacierDropdownList"]').removeClass('show2');
                        $('[id="baselayerDropdownList"]').removeClass('show1');
                    });
                };

                // create polygon legend
                function drawPolyLegend() {
                    const legendPolyList = L.control({
                        position: 'bottomleft'
                    });
                    legendPolyList.onAdd = function (map) {
                        div = L.DomUtil.create('div', 'legendPolyList');
                        return div;
                    }
                    legendPolyList.addTo(map);
                    $(".legendPolyList").hide();

                    L.DomEvent.addListener(div, 'mousewheel', function (e) {
                        L.DomEvent.stopPropagation(e);
                    });
                }

                // toggle the polygon layers on the polygon legend
                function togglePolys() {

                    $("#polyLIA").on('change', function () {
                        if ($(this).is(':checked')) {
                            map.addLayer(liaLayer);
                            addInteractionsLIA(liaLayer);
                        } else {
                            map.removeLayer(liaLayer);
                        }
                    }).change(); // chain function to work onload and onchange
                    $("#poly66").on('change', function () {
                        if ($(this).is(':checked')) {
                            map.addLayer(layer66);
                            addInteractions66(layer66);
                        } else {
                            map.removeLayer(layer66);
                        }
                    }).change();
                    $("#poly98").on('change', function () {
                        if ($(this).is(':checked')) {
                            map.addLayer(layer98);
                            addInteractions98(layer98);
                        } else {
                            map.removeLayer(layer98);
                        }
                    }).change();
                    $("#poly05").on('change', function () {
                        if ($(this).is(':checked')) {
                            map.addLayer(layer05);
                            addInteractions05(layer05);
                        } else {
                            map.removeLayer(layer05);
                        }
                    }).change();
                    $("#poly15").on('change', function () {
                        if ($(this).is(':checked')) {
                            map.addLayer(layer15);
                            addInteractions15(layer15);
                        } else {
                            map.removeLayer(layer15);
                        }
                    }).change();
                };

                // add legend content
                function updatePolyLegend(layer) {
                    const legendPolyName = layer.feature.properties['GLACNAME'];
                    const glacNum = layer.feature.properties['num'];
                    const modalType = layer.feature.properties['P_TYPE'];
                    const imageLeftM1 = layer.feature.properties['P_S1'];
                    const imageRightM1 = layer.feature.properties['P_S2'];
                    const imageM2 = layer.feature.properties['P_S3'];
                    const imageM3 = layer.feature.properties['P_S5'];
                    const attributionLM1 = layer.feature.properties['P1_ATTR_L'];
                    const attributionRM1 = layer.feature.properties['P2_ATTR_R'];
                    const attributionLM2 = layer.feature.properties['P3_ATTR_L'];
                    const attributionRM2 = layer.feature.properties['P4_ATTR_R'];
                    const attributionRM3 = layer.feature.properties['P5_ATTR_R'];
                    const yearLM1 = layer.feature.properties['P1_YR_L'];
                    const yearRM1 = layer.feature.properties['P2_YR_R'];
                    const yearLM2 = layer.feature.properties['P3_YR_L'];
                    const yearRM2 = layer.feature.properties['P4_YR_R'];
                    const yearRM3 = layer.feature.properties['P5_YR_R'];

                    const legendPolyTitle = "<div class='polyLegendMain'>" +
                        "<h4 class='polyLegendTitle'>" +
                        legendPolyName +
                        $("#photoIcon").html() + "</h4>" + "</div>";
                    $(".legendPolyList").html(legendPolyTitle);

                    const closeIcon = $(".legendPolyCloseIcon").html();
                    $(closeIcon).insertBefore(".polyLegendMain");

                    // get modal type on camera icon click
                    $("#camera-icon").click(function () {
                        $(".modalTitle").append(legendPolyName);

                        if (modalType === "1") {
                            function loadModal1Image() {
                                $("#imageLeftM1").attr("src", imageLeftM1);
                                $("#imageRightM1").attr("src", imageRightM1);
                            }
                            $.when(loadModal1Image()).done(function () {
                                $(".attributionLM1").text("Photo Left: " +
                                    attributionLM1);
                                $(".attributionRM1").text("Photo Right: " +
                                    attributionRM1);
                                $(".yearLM1").attr("data-beer-label", yearLM1);
                                $(".yearRM1").attr("data-beer-label", yearRM1);
                                $("#camera-icon").addClass("modal1_open");
                            });
                        } else if (modalType === "3") {
                            function loadModal2Image() {
                                $("#imageM2").attr("src", imageM2);
                            }
                            $.when(loadModal2Image()).done(function () {
                                $(".attributionLM2").text("Photo Left: " +
                                    attributionLM2);
                                $(".attributionRM2").text("Photo Right: " +
                                    attributionRM2);
                                $(".yearLM2").attr("year-left", yearLM2);
                                $(".yearRM2").attr("year-right", yearRM2);
                                $("#camera-icon").addClass("modal2_open");
                            });
                        } else if (modalType === "5") {
                            function loadModal3Image() {
                                $("#imageM3").attr("src", imageM3);
                            }
                            $.when(loadModal3Image()).done(function () {
                                $(".attributionRM3").text("Photo: " +
                                    attributionRM3);
                                $(".yearRM3").attr("year-right", yearRM3);
                                $("#camera-icon").addClass("modal3_open");
                            });
                        }
                    });

                    // clear modal components on modal close
                    $(".modal_close").click(function () {
                        $(".modalTitle").empty();
                        $(".attributionLM1").empty();
                        $(".attributionRM1").empty();
                        $(".attributionLM2").empty();
                        $(".attributionRM2").empty();
                        $(".attributionRM3").empty();
                        $("input[data-beer-label]").empty();
                        $("input[year-left]").empty();
                        $("input[year-right]").empty();
                    });

                    // toggle poly legend
                    togglePolyLegend();

                    function togglePolyLegend() {
                        $('.closePolyIcon').click(function () {
                            $('.legendPolyList').fadeOut();
                            $('#glacierPolyLegendSm').fadeIn();
                        });
                        $('.glacierPolyLegendSm').click(function () {
                            $('#glacierPolyLegendSm').fadeOut();
                            $('.legendPolyList').fadeIn();
                        });
                    };

                    const legendPolyAreaTitle = "<h4 class='polyLegendAreaTitle'>" +
                        "Glacial Extents " +
                        "</h4>"
                    $(legendPolyAreaTitle).insertAfter("#camera-icon");

                    // get polygon years toggle buttons
                    const polygonYearsGroup = $("#polygonYearsGroup").html();
                    $(polygonYearsGroup).insertAfter(".polyLegendAreaTitle");

                    const areaChartTitle = "<h4 class='areaChartTitle'>" + "Glacier Area " +
                        "<span class='areaChartSubTitle'>" + "(1966 &ndash; 2015)" + "</span>" +
                        "</h4>"
                    $(areaChartTitle).insertAfter("#switchGroup2");

                    // d3.js bar chart
                    getAreaData(areaData);

                    function getAreaData(areaData) {
                        // filter dataset
                        const filteredData = areaData.filter(function (d) {
                            if (d["GLACNAME"] == legendPolyName) {
                                return d;
                            }
                        })

                        // alphabetize by year
                        filteredData.sort(function (a, b) {
                            return a.Year - b.Year
                        }).reverse();

                        // compute area calculations
                        const area1966 = filteredData[0].AREA;
                        const area2015 = filteredData[3].AREA;
                        const format = d3.format(",.3f");
                        const areaDif = format((area1966 - area2015) * 0.000001);
                        const areaAcres = format((area1966 - area2015) * 0.0002471053814671738146717);

                        const areaChartText = "<div class='areaChartText'>" +
                            "50-year change in area: &thinsp;" + "<span class='areaChartCalcs'>" +
                            areaDif + " km&sup2;" + "</span>" + "&thinsp;or" + "<br>" +
                            "<span class='areaChartCalcs'>" + areaAcres + " acres" +
                            "</span>" + "</div>"
                        $(areaChartText).insertAfter(".areaChartTitle");

                        const chart1Canvas = "<div class='wrapper1' id='wrapper1'>" + "</div>"
                        $(chart1Canvas).insertAfter(".areaChartText");

                        // create bar chart dimensions
                        const width = 230
                        const height = 110
                        let dimensions = {
                            width: width,
                            height: height,
                            margin: {
                                top: 7,
                                right: 0,
                                bottom: 15,
                                left: 30,
                            },
                        }
                        dimensions.boundedWidth = dimensions.width - dimensions.margin.left -
                            dimensions.margin
                            .right
                        dimensions.boundedHeight = dimensions.height - dimensions.margin.top -
                            dimensions.margin
                            .bottom

                        // draw canvas
                        const wrapper1 = d3.select("#wrapper1")
                            .append("svg")
                            .attr("width", dimensions.width + dimensions.margin.left + dimensions
                                .margin.right)
                            .attr("height", dimensions.height + dimensions.margin.top + dimensions
                                .margin
                                .bottom)
                            .append("g")
                            .attr("transform", "translate(" + dimensions.margin.left + "," +
                                dimensions.margin
                                .top + ")");

                        const bounds1 = wrapper1.append("g")
                            .attr("transform", "translate(" + dimensions.margin.left + "," +
                                dimensions.margin
                                .top + ")");

                        // format the data
                        filteredData.forEach(function (d) {
                            d.area = +d.AREA
                        });

                        const area = d => d.area
                        const yAccessor = d => d.length
                        const xAccessor = d => d.Year

                        // create tooltip
                        const tooltip1 = d3.select("body")
                            .append("div")
                            .attr("class", "tooltip1")
                            .style("position", "absolute")
                            .style("z-index", "10")
                            .style("visibility", "hidden")

                        // create scales
                        const xScale = d3.scaleLinear()
                            .domain([0, d3.max(filteredData, function (d) {
                                return d.area;
                            })])
                            .range([0, dimensions.boundedWidth])
                            .nice();

                        const yScale = d3.scaleBand()
                            .domain(filteredData.map(function (d) {
                                return d.Year;
                            }))
                            .range([dimensions.boundedHeight, 0])
                            .padding(0.3);

                        // add bars
                        const bars = wrapper1.selectAll(".bar")
                            .data(filteredData)
                            .enter().append("rect")
                            .attr("class", "bar")
                            .attr("x", xScale(0))
                            .attr("y", function (d) {
                                return yScale(0);
                            })
                            .attr("width", function (d) {
                                return xScale(0);
                            })
                            .attr("height", yScale.bandwidth())

                            .on("mouseover", function (d) {
                                if (d.Year == 1966) {
                                    layer66.eachLayer(function (layer) {
                                        if (layer.feature.properties['GLACNAME'] == d[
                                                "GLACNAME"] &&
                                            layer.feature.properties['Year'] === "1966"
                                        ) {
                                            layer.setStyle({
                                                color: "#ff3d00",
                                                weight: 2,
                                            });
                                        }
                                    });
                                }
                                if (d.Year == 1998) {
                                    layer98.eachLayer(function (layer) {
                                        if (layer.feature.properties['GLACNAME'] == d[
                                                "GLACNAME"] &&
                                            layer.feature.properties['Year'] === "1998"
                                        ) {
                                            layer.setStyle({
                                                color: "#ff3d00",
                                                weight: 2,
                                            });
                                        }
                                    });
                                }
                                if (d.Year == 2005) {
                                    layer05.eachLayer(function (layer) {
                                        if (layer.feature.properties['GLACNAME'] == d[
                                                "GLACNAME"] &&
                                            layer.feature.properties['Year'] === "2005"
                                        ) {
                                            layer.setStyle({
                                                color: "#ff3d00",
                                                weight: 2,
                                            });
                                        }
                                    });
                                }
                                if (d.Year == 2015) {
                                    layer15.eachLayer(function (layer) {
                                        if (layer.feature.properties['GLACNAME'] == d[
                                                "GLACNAME"] &&
                                            layer.feature.properties['Year'] === "2015"
                                        ) {
                                            layer.setStyle({
                                                color: "#ff3d00",
                                                weight: 2,
                                            });
                                        }
                                    });
                                }

                                const format = d3.format(",.3f")
                                return tooltip1
                                    .style("visibility", "visible")
                                    .html("<span class='barYear'>" + d.Year + "</span><br>" +
                                        "Area: &thinsp;" + "<span class='barArea'>" + format((d
                                            .AREA) * 0.000001) +
                                        " km&sup2;" + "</span>" + " or" + "<br>" +
                                        "<span class=barTooltipTextAcres>" +
                                        "<span class='barArea'>" + format(d.AREA *
                                            0.0002471053814671738146717) + " acres" +
                                        "</span></span>")
                            })
                            .on("mousemove", function (d) {
                                return tooltip1
                                    .style("top", (d3.event.pageY - 70) + "px")
                                    .style("left", (d3.event.pageX - 60) + "px");
                            })
                            .on("mouseout", function (d) {
                                if (d.Year == 1966) {
                                    layer66.eachLayer(function (layer) {
                                        layer.setStyle({
                                            color: "#26C6DA",
                                            weight: 1.5,
                                        });
                                    });
                                }
                                if (d.Year == 1998) {
                                    layer98.eachLayer(function (layer) {
                                        layer.setStyle({
                                            color: "#00BCD4",
                                            weight: 1.5,
                                        });
                                    });
                                }
                                if (d.Year == 2005) {
                                    layer05.eachLayer(function (layer) {
                                        layer.setStyle({
                                            color: "#00ACC1",
                                            weight: 1.5,
                                        });
                                    });
                                }
                                if (d.Year == 2015) {
                                    layer15.eachLayer(function (layer) {
                                        layer.setStyle({
                                            color: "#00A0B5",
                                            weight: 1.5,
                                        });
                                    });
                                }
                                return tooltip1
                                    .style("visibility", "hidden");
                            });

                        // add unique id to each bar
                        $('.bar').attr("id", function (i) {
                            return 'bar' + i;
                        });


                        //add x-axis
                        const xAxis = wrapper1.append("g")
                            .attr("class", "x-axis")
                            .attr("transform", "translate(0," + dimensions.boundedHeight + ")")
                            .call(d3.axisBottom(xScale).ticks(3));

                        // add y-axis
                        const yAxis = wrapper1.append("g")
                            .attr("class", "y-axis")
                            .call(d3.axisLeft(yScale));

                        // label y-axis
                        const yAxisLabel = yAxis.append("text")
                            .attr("class", "x-axis-label")
                            .attr("fill", "#989898")
                            .attr("x", -dimensions.margin.top + 115)
                            .attr("y", -dimensions.margin.left + 150)
                            .attr("text-anchor", "middle")
                            .html("Area m&sup2;");

                        // animate bars
                        const animation = wrapper1.selectAll("rect")
                            .transition()
                            .duration(1200)
                            .delay(function (d, i) {
                                return (i * 100)
                            })
                            .attr("width", function (d) {
                                return xScale(d.AREA);
                            })
                            .attr("y", function (d) {
                                return yScale(d.Year);
                            })
                    };

                    // d3.js climate charts
                    getClimateData(climateData);

                    function getClimateData(climateData) {

                        // filter dataset
                        const filteredClimateData = climateData.filter(function (d) {
                            if (d["NUM"] == glacNum) {
                                return d;
                            }
                        });

                        // alphabetize by year
                        filteredClimateData.sort(function (a, b) {
                            return a.YEAR - b.YEAR
                        });

                        buildLineSwitch();
                        drawTempChart();
                        drawPrecipChart();

                        // climate chart toggle button 
                        function buildLineSwitch() {

                            const climateDataTitle = "<h4 class='climateDataTitle'>" +
                                "Climatological Data " +
                                "</h4>"
                            $(climateDataTitle).insertAfter(".wrapper1");

                            const climateToggles = $("#climateChartsToggle").html();
                            $(climateToggles).insertAfter(".climateDataTitle");
                            $(".tempDiv").show();
                            $(".precipDiv").hide();

                            $("#tempToggle").click(function () {
                                $(".precipDiv").hide();
                                $(".tempDiv").show();
                                $("#wrapper2").empty();
                                drawTempChart();
                            });
                            $("#precipToggle").click(function () {
                                $(".tempDiv").hide();
                                $(".precipDiv").show();
                                $("#wrapper3").empty();
                                drawPrecipChart();
                            });
                        };

                        // d3.js temperature line chart
                        function drawTempChart() {

                            // access data
                            const dataset = filteredClimateData
                            const yAccessor = d => +d.TMEANF;
                            const dateParser = d3.timeParse("%Y");
                            const xAccessor = d => dateParser(d.YEAR);

                            const chart2Canvas = $(".wrapper2").html();

                            // create chart dimensions
                            const width = 270
                            const height = 125
                            let dimensions = {
                                width: width,
                                height: height,
                                margin: {
                                    top: 15,
                                    right: 15,
                                    bottom: 17,
                                    left: 60,
                                },
                            }

                            dimensions.boundedWidth = dimensions.width -
                                dimensions.margin.left -
                                dimensions.margin.right
                            dimensions.boundedHeight = dimensions.height -
                                dimensions.margin.top -
                                dimensions.margin.bottom

                            // draw canvas
                            const wrapper2 = d3.select("#wrapper2")
                                .append("svg")
                                .attr("width", dimensions.width)
                                .attr("height", dimensions.height)

                            const bounds2 = wrapper2.append("g")
                                .style("transform",
                                    `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`
                                )

                            // create scales
                            const yScale = d3.scaleLinear()
                                .domain(d3.extent(dataset, yAccessor))
                                .range([dimensions.boundedHeight, 0])
                                .nice()

                            const xScale = d3.scaleTime()
                                .domain(d3.extent(dataset, xAccessor))
                                .range([0, dimensions.boundedWidth])

                            // group data to get group mean
                            const yearNames = ["1966-1997", "1998-2004", "2005-2015"]

                            let yearsData = []

                            const startDate1 = xAccessor(dataset[0])
                            const endDate1 = xAccessor(dataset[32])
                            const startDate2 = xAccessor(dataset[32])
                            const endDate2 = xAccessor(dataset[39])
                            const startDate3 = xAccessor(dataset[39])
                            const endDate3 = xAccessor(dataset[49])

                            const group1 = d3.timeYears(startDate1, endDate1)
                            const yearsFilter1 = dataset.filter(d => xAccessor(d) >= startDate1 &&
                                xAccessor(
                                    d) < endDate1)
                            if (!yearsFilter1.length) return
                            yearsData.push({
                                start: startDate1,
                                end: endDate1,
                                id: "group1",
                                name: yearNames[0],
                                mean: d3.mean(yearsFilter1, yAccessor),
                            })
                            const group2 = d3.timeYears(startDate2, endDate2)
                            const yearsFilter2 = dataset.filter(d => xAccessor(d) >= startDate2 &&
                                xAccessor(
                                    d) < endDate2)
                            if (!yearsFilter2.length) return
                            yearsData.push({
                                start: startDate2,
                                end: endDate2,
                                id: "group2",
                                name: yearNames[1],
                                mean: d3.mean(yearsFilter2, yAccessor),
                            })
                            const group3 = d3.timeYears(startDate3, endDate3)
                            const yearsFilter3 = dataset.filter(d => xAccessor(d) >= startDate3 &&
                                xAccessor(
                                    d) <= endDate3)
                            if (!yearsFilter3.length) return
                            yearsData.push({
                                start: startDate3,
                                end: endDate3,
                                id: "group3",
                                name: yearNames[2],
                                mean: d3.mean(yearsFilter3, yAccessor),
                            })

                            const yearOffset = 0
                            const yearArea = bounds2.selectAll(".yearArea")
                                .data(yearsData)
                                .enter().append("rect")
                                .attr("x", d => xScale(d.start))
                                .attr("width", d => xScale(d.end) - xScale(d.start))
                                .attr("y", yearOffset)
                                .attr("height", dimensions.boundedHeight - yearOffset)
                                .attr("class", d => `year ${d.id}`)

                            // draw annual line 
                            const lineGenerator = d3.line()
                                .x(d => xScale(xAccessor(d)))
                                .y(d => yScale(yAccessor(d)))
                                .curve(d3.curveMonotoneX);

                            const line = bounds2.append("path")
                                .attr("d", lineGenerator(dataset))
                                .attr("fill", "none")
                                .attr("stroke", "#333")
                                .attr("stroke-width", 1.5)
                                .attr("class", "line")

                            // draw peripherals
                            const yearGroupMeans = bounds2.selectAll(".year-group-mean1")
                                .data(yearsData)
                                .enter().append("line")
                                .attr("x1", d => xScale(d.start))
                                .attr("x2", d => xScale(d.end))
                                .attr("y1", d => yScale(d.mean))
                                .attr("y2", d => yScale(d.mean))

                            yearGroupMeans
                                .transition()
                                .delay(1400)
                                .duration(60)
                                .ease(d3.easeLinear)
                                .attr("class", "year-group-mean1")

                            const yAxisGenerator = d3.axisLeft()
                                .scale(yScale)
                                .ticks(4)

                            const yAxis = bounds2.append("g")
                                .attr("class", "y-axis")
                                .call(yAxisGenerator)

                            const yAxisLabel = yAxis.append("text")
                                .attr("class", "y-axis-label")
                                .attr("fill", "#989898")
                                .attr("transform", "rotate(-90)")
                                .attr("x", -dimensions.boundedHeight / 2)
                                .attr("y", -dimensions.margin.left + 26)
                                .attr("text-anchor", "middle")
                                .html("Temperature (&#8239;&#8457;&#8239;)");

                            const yearValues = [startDate1, startDate2, startDate3, endDate3]

                            const xAxisGenerator = d3.axisBottom()
                                .scale(xScale)
                                .tickValues(yearValues)

                            const xAxis = bounds2.append("g")
                                .attr("class", "x-axis")
                                .call(xAxisGenerator)
                                .style("transform", `translateY(${(dimensions.boundedHeight)}px)`)

                            // animation
                            const totalLineLength = line.node().getTotalLength();

                            line
                                .attr("stroke-dasharray", totalLineLength + " " + totalLineLength)
                                .attr("stroke-dashoffset", totalLineLength)
                                .transition()
                                .duration(1200)
                                .ease(d3.easeLinear)
                                .attr("stroke-dashoffset", 0);

                            // hover interactions
                            const tooltipCircle = bounds2.append("circle")
                                .attr("class", "tooltip-circle")
                                .attr("r", 3.5)
                                .attr("stroke", "#333")
                                .attr("fill", "#ff3d00")
                                .attr("stroke-width", 2)
                                .style("opacity", 0)

                            const listeningRect = bounds2.append("rect")
                                .attr("class", "listening-rect")
                                .attr("width", dimensions.boundedWidth)
                                .attr("height", dimensions.boundedHeight)
                                .on("mousemove", onMouseMove)
                                .on("mouseleave", onMouseLeave)

                            // create tooltip
                            const tooltip2 = d3.select("body")
                                .append("div")
                                .attr("class", "tooltip2")
                                .style("position", "absolute")
                                .style("z-index", "10")
                                .style("visibility", "hidden")

                            return tooltip2
                                .style("visibility", "visible")
                                .html("<span class='tooltip-date'>" + "<span class='date'>" +
                                    "</span>" +
                                    "</span>" + "<br>" +
                                    "<span class='tooltip-text'>" + "</span>" +
                                    "<div class='tooltip-text'>" +
                                    "Average annual air" + "<br>" + "temperature: &thinsp;" +
                                    "<span id='temp'>" + "</span></div>")

                            function onMouseMove() {
                                const mousePosition = d3.mouse(this)
                                const hoveredDate = xScale.invert(mousePosition[0])

                                const getDistanceFromHoveredDate = d => Math.abs(xAccessor(d) -
                                    hoveredDate)
                                const closestIndex = d3.scan(dataset, (a, b) => (
                                    getDistanceFromHoveredDate(a) -
                                    getDistanceFromHoveredDate(b)
                                ))
                                const closestDataPoint = dataset[closestIndex]

                                const closestXValue = xAccessor(closestDataPoint)
                                const closestYValue = yAccessor(closestDataPoint)

                                const formatDate = d3.timeFormat("%Y")
                                tooltip2.select(".date")
                                    .text(formatDate(closestXValue))

                                const formatTemperature = d => `${d3.format(".1f")(d)}F`
                                tooltip2.select("#temp")
                                    .text(formatTemperature(closestYValue))

                                const x = xScale(closestXValue) +
                                    dimensions.margin.left
                                const y = yScale(closestYValue) +
                                    dimensions.margin.top

                                tooltip2.style("transform", `translate(` +
                                    `calc( -50% + ${x}px),` +
                                    `calc(-100% + ${y}px)` +
                                    `)`)

                                tooltip2.style("opacity", 1)

                                tooltipCircle
                                    .attr("cx", xScale(closestXValue))
                                    .attr("cy", yScale(closestYValue))
                                    .style("opacity", 1)
                            }

                            function onMouseLeave() {
                                tooltip2.style("opacity", 0)
                                tooltipCircle.style("opacity", 0)
                            }
                        };

                        // d3.js precipitation line chart
                        function drawPrecipChart() {

                            // access data
                            const dataset = filteredClimateData
                            const yAccessor = d => +d.PPTIN;
                            const dateParser = d3.timeParse("%Y");
                            const xAccessor = d => dateParser(d.YEAR);

                            const chart2Canvas = $(".wrapper3").html();

                            // create chart dimensions
                            const width = 270
                            const height = 125
                            let dimensions = {
                                width: width,
                                height: height,
                                margin: {
                                    top: 15,
                                    right: 15,
                                    bottom: 17,
                                    left: 60,
                                },
                            }

                            dimensions.boundedWidth = dimensions.width -
                                dimensions.margin.left -
                                dimensions.margin.right
                            dimensions.boundedHeight = dimensions.height -
                                dimensions.margin.top -
                                dimensions.margin.bottom

                            // draw canvas
                            const wrapper3 = d3.select("#wrapper3")
                                .append("svg")
                                .attr("width", dimensions.width)
                                .attr("height", dimensions.height)

                            const bounds3 = wrapper3.append("g")
                                .style("transform",
                                    `translate(${dimensions.margin.left}px, ${dimensions.margin.top}px)`
                                )

                            // create scales
                            const yScale = d3.scaleLinear()
                                .domain(d3.extent(dataset, yAccessor))
                                .range([dimensions.boundedHeight, 0])
                                .nice()

                            const xScale = d3.scaleTime()
                                .domain(d3.extent(dataset, xAccessor))
                                .range([0, dimensions.boundedWidth])

                            // group data to get group mean
                            const yearNames = ["1966-1997", "1998-2004", "2005-2015"]

                            let yearsData = []

                            const startDate1 = xAccessor(dataset[0])
                            const endDate1 = xAccessor(dataset[32])
                            const startDate2 = xAccessor(dataset[32])
                            const endDate2 = xAccessor(dataset[39])
                            const startDate3 = xAccessor(dataset[39])
                            const endDate3 = xAccessor(dataset[49])

                            const group1 = d3.timeYears(startDate1, endDate1)
                            const yearsFilter1 = dataset.filter(d => xAccessor(d) >= startDate1 &&
                                xAccessor(
                                    d) < endDate1)
                            if (!yearsFilter1.length) return
                            yearsData.push({
                                start: startDate1,
                                end: endDate1,
                                id: "group1",
                                name: yearNames[0],
                                mean: d3.mean(yearsFilter1, yAccessor),
                            })
                            const group2 = d3.timeYears(startDate2, endDate2)
                            const yearsFilter2 = dataset.filter(d => xAccessor(d) >= startDate2 &&
                                xAccessor(
                                    d) < endDate2)
                            if (!yearsFilter2.length) return
                            yearsData.push({
                                start: startDate2,
                                end: endDate2,
                                id: "group2",
                                name: yearNames[1],
                                mean: d3.mean(yearsFilter2, yAccessor),
                            })
                            const group3 = d3.timeYears(startDate3, endDate3)
                            const yearsFilter3 = dataset.filter(d => xAccessor(d) >= startDate3 &&
                                xAccessor(
                                    d) <= endDate3)
                            if (!yearsFilter3.length) return
                            yearsData.push({
                                start: startDate3,
                                end: endDate3,
                                id: "group3",
                                name: yearNames[2],
                                mean: d3.mean(yearsFilter3, yAccessor),
                            })

                            const yearOffset = 0
                            const yearArea = bounds3.selectAll(".yearArea")
                                .data(yearsData)
                                .enter().append("rect")
                                .attr("x", d => xScale(d.start))
                                .attr("width", d => xScale(d.end) - xScale(d.start))
                                .attr("y", yearOffset)
                                .attr("height", dimensions.boundedHeight - yearOffset)
                                .attr("class", d => `year ${d.id}`)

                            // draw annual line 
                            const lineGenerator = d3.line()
                                .x(d => xScale(xAccessor(d)))
                                .y(d => yScale(yAccessor(d)))
                                .curve(d3.curveMonotoneX);

                            const line = bounds3.append("path")
                                .attr("d", lineGenerator(dataset))
                                .attr("fill", "none")
                                .attr("stroke", "#333")
                                .attr("stroke-width", 1.5)
                                .attr("class", "line")

                            // draw peripherals
                            const yearGroupMeans = bounds3.selectAll(".year-group-mean2")
                                .data(yearsData)
                                .enter().append("line")
                                .attr("x1", d => xScale(d.start))
                                .attr("x2", d => xScale(d.end))
                                .attr("y1", d => yScale(d.mean))
                                .attr("y2", d => yScale(d.mean))

                            yearGroupMeans
                                .transition()
                                .delay(1400)
                                .duration(60)
                                .ease(d3.easeLinear)
                                .attr("class", "year-group-mean2")

                            const yAxisGenerator = d3.axisLeft()
                                .scale(yScale)
                                .ticks(4)

                            const yAxis = bounds3.append("g")
                                .attr("class", "y-axis")
                                .call(yAxisGenerator)

                            const yAxisLabel = yAxis.append("text")
                                .attr("class", "y-axis-label")
                                .attr("fill", "#989898")
                                .attr("transform", "rotate(-90)")
                                .attr("x", -dimensions.boundedHeight / 2)
                                .attr("y", -dimensions.margin.left + 26)
                                .attr("text-anchor", "middle")
                                .html("Precipitation (&#8239;in&#8239;)");

                            const yearValues = [startDate1, startDate2, startDate3, endDate3]

                            const xAxisGenerator = d3.axisBottom()
                                .scale(xScale)
                                .tickValues(yearValues)

                            const xAxis = bounds3.append("g")
                                .attr("class", "x-axis")
                                .call(xAxisGenerator)
                                .style("transform", `translateY(${(dimensions.boundedHeight)}px)`)

                            // animation
                            if ($('#wrapper3').is(':visible')) {

                                const totalLineLength = line.node().getTotalLength();

                                line
                                    .attr("stroke-dasharray", totalLineLength + " " +
                                        totalLineLength)
                                    .attr("stroke-dashoffset", totalLineLength)
                                    .transition()
                                    .duration(1200)
                                    .ease(d3.easeLinear)
                                    .attr("stroke-dashoffset", 0);
                            };

                            // hover interactions
                            const tooltipCircle = bounds3.append("circle")
                                .attr("class", "tooltip-circle")
                                .attr("r", 3.5)
                                .attr("stroke", "#333")
                                .attr("fill", "#00BCD4")
                                .attr("stroke-width", 2)
                                .style("opacity", 0)

                            const listeningRect = bounds3.append("rect")
                                .attr("class", "listening-rect")
                                .attr("width", dimensions.boundedWidth)
                                .attr("height", dimensions.boundedHeight)
                                .on("mousemove", onMouseMove)
                                .on("mouseleave", onMouseLeave)

                            // create tooltip
                            const tooltip3 = d3.select("body")
                                .append("div")
                                .attr("class", "tooltip3")
                                .style("position", "absolute")
                                .style("z-index", "10")
                                .style("visibility", "hidden")

                            return tooltip3
                                .style("visibility", "visible")
                                .html("<span class='tooltip-date'>" + "<span class='date'>" +
                                    "</span>" +
                                    "</span>" + "<br>" +
                                    "<span class='tooltip-text'>" + "</span>" +
                                    "<div class='tooltip-text'>" +
                                    "Total annual" + "<br>" + "precipitation: &thinsp;" +
                                    "<span id='precip'>" +
                                    "</span></div>")

                            function onMouseMove() {
                                const mousePosition = d3.mouse(this)
                                const hoveredDate = xScale.invert(mousePosition[0])

                                const getDistanceFromHoveredDate = d => Math.abs(xAccessor(d) -
                                    hoveredDate)
                                const closestIndex = d3.scan(dataset, (a, b) => (
                                    getDistanceFromHoveredDate(a) -
                                    getDistanceFromHoveredDate(b)
                                ))
                                const closestDataPoint = dataset[closestIndex]

                                const closestXValue = xAccessor(closestDataPoint)
                                const closestYValue = yAccessor(closestDataPoint)

                                const formatDate = d3.timeFormat("%Y")
                                tooltip3.select(".date")
                                    .text(formatDate(closestXValue))

                                const formatTemperature = d => `${d3.format(".1f")(d)} in`
                                tooltip3.select("#precip")
                                    .text(formatTemperature(closestYValue))

                                const x = xScale(closestXValue) +
                                    dimensions.margin.left
                                const y = yScale(closestYValue) +
                                    dimensions.margin.top

                                tooltip3.style("transform", `translate(` +
                                    `calc( -50% + ${x}px),` +
                                    `calc(-100% + ${y}px)` +
                                    `)`)

                                tooltip3.style("opacity", 1)

                                tooltipCircle
                                    .attr("cx", xScale(closestXValue))
                                    .attr("cy", yScale(closestYValue))
                                    .style("opacity", 1)
                            }

                            function onMouseLeave() {
                                tooltip3.style("opacity", 0)
                                tooltipCircle.style("opacity", 0)
                            }
                        };
                    };
                }
                $('#loader').remove();
            };
        });
    </script>
</body>

</html>